<!DOCTYPE html>

<html lang="en">

<head>

	<meta charset="utf-8" />

	<title>{{ site_title }} Administration</title>

	<meta name="robots" content="noindex, nofollow" />

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" type="text/css" href="{{ base_url }}/plugins/pico_edit/normalize.css" />
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,700&amp;subset=cyrillic,greek" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="{{ base_url }}/plugins/pico_edit/styles.css?v=4" />

	<link rel="icon" type="image/png" href="{{ base_url }}/plugins/pico_edit/assets/favicon.png"/>

</head>

<body>

	<div class='grid-wrap'>
		<div class='grid-item header'>

			<!-- <a href="#main-menu" class="menu-toggle">&#9776;</a> -->

			<h1>

				{{ site_title }} Administration <a href="{{ base_url }}" id="logo" target="_blank">View Website</a>

			</h1>

		</div>

		<div class="controls">

			<a href="#" class="new" title="New">+ New Page</a>

			<a href="#" class="clearcachebutton" title="Clear Cache">Clear Cache</a>

			<a href="{{ pico_edit_url }}/logout" class="logout" id="logout" title="Logout">Logout</a>

		</div>

		<div class='grid-item content'>

			<div id="epiceditor"></div>

			<div class="controls">

				<a href="#" class="savebutton" title="Save">Save</a>

				<a href="#preview-btn" id="preview-btn">Preview</a>

				<a href="#edit-btn" id="edit-btn" >Edit</a>

			</div>

		</div>

		<div class='grid-item sidebar'>

			<ul class="nav">

				{% if config.pico_edit_options %}

					<li class="padding-s display-block"><a href="#" data-url="conf" class="post page-options"><i>config options</i></a></li>

				{% endif %} 

				{% if config.pico_edit_404 %}

					<li class="padding-s display-block"><a href="#" data-url="/404" class="post page-404"><i>404</i></a></li>

				{% endif %} 

				{% for page in pages %}

					<li class="padding-xs padding-left-s padding-right-s display-block">
						
						<a href="#" data-url="{{ page.id }}" class="post">/{{ page.id }}</a>
						
						<a href="#" data-url="{{ page.id }}" class="delete" title="Delete Page"><img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMS4xLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDE3NC4yMzkgMTc0LjIzOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTc0LjIzOSAxNzQuMjM5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjUxMnB4IiBoZWlnaHQ9IjUxMnB4Ij4KPGc+Cgk8cGF0aCBkPSJNODcuMTIsMEMzOS4wODIsMCwwLDM5LjA4MiwwLDg3LjEyczM5LjA4Miw4Ny4xMiw4Ny4xMiw4Ny4xMnM4Ny4xMi0zOS4wODIsODcuMTItODcuMTJTMTM1LjE1NywwLDg3LjEyLDB6IE04Ny4xMiwxNTkuMzA1ICAgYy0zOS44MDIsMC03Mi4xODUtMzIuMzgzLTcyLjE4NS03Mi4xODVTNDcuMzE4LDE0LjkzNSw4Ny4xMiwxNC45MzVzNzIuMTg1LDMyLjM4Myw3Mi4xODUsNzIuMTg1UzEyNi45MjEsMTU5LjMwNSw4Ny4xMiwxNTkuMzA1eiIgZmlsbD0iI0Q4MDAyNyIvPgoJPHBhdGggZD0iTTEyMC44Myw1My40MTRjLTIuOTE3LTIuOTE3LTcuNjQ3LTIuOTE3LTEwLjU1OSwwTDg3LjEyLDc2LjU2OEw2My45NjksNTMuNDE0Yy0yLjkxNy0yLjkxNy03LjY0Mi0yLjkxNy0xMC41NTksMCAgIHMtMi45MTcsNy42NDIsMCwxMC41NTlsMjMuMTUxLDIzLjE1M0w1My40MDksMTEwLjI4Yy0yLjkxNywyLjkxNy0yLjkxNyw3LjY0MiwwLDEwLjU1OWMxLjQ1OCwxLjQ1OCwzLjM2OSwyLjE4OCw1LjI4LDIuMTg4ICAgYzEuOTExLDAsMy44MjQtMC43MjksNS4yOC0yLjE4OEw4Ny4xMiw5Ny42ODZsMjMuMTUxLDIzLjE1M2MxLjQ1OCwxLjQ1OCwzLjM2OSwyLjE4OCw1LjI4LDIuMTg4YzEuOTExLDAsMy44MjEtMC43MjksNS4yOC0yLjE4OCAgIGMyLjkxNy0yLjkxNywyLjkxNy03LjY0MiwwLTEwLjU1OUw5Ny42NzksODcuMTI3bDIzLjE1MS0yMy4xNTNDMTIzLjc0Nyw2MS4wNTcsMTIzLjc0Nyw1Ni4zMzEsMTIwLjgzLDUzLjQxNHoiIGZpbGw9IiNEODAwMjciLz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K" /></a>

						<a href="{{ page.url }}" target="_blank" class="view" title="View Page"><img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjI0cHgiIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDU3Ny4wMjkgNTc3LjAyOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNTc3LjAyOSA1NzcuMDI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTI4OC41MTQsMTQ4LjYyOWM3My43NDYsMCwxMzYuMTYyLDMzLjYxNiwxNzUuNTM5LDYxLjgyMWM0Ni42NTIsMzMuNDE1LDcwLjY2LDY1LjczNyw3Ni44ODUsNzguMDY1ICAgYy02LjIzMiwxMi4zMjctMzAuMjMyLDQ0LjY0OS03Ni44ODUsNzguMDY1Yy0zOS4zNzcsMjguMjA0LTEwMS43OTMsNjEuODItMTc1LjUzOSw2MS44MmMtNzMuNzQ2LDAtMTM2LjE2MS0zMy42MTYtMTc1LjUzOS02MS44MiAgIGMtNDYuNjYxLTMzLjQxNi03MC42Ni02NS43MzgtNzYuODk0LTc4LjA2NWM2LjIzNC0xMi4zMjgsMzAuMjMzLTQ0LjY1LDc2Ljg4NS03OC4wNjUgICBDMTUyLjM1MywxODIuMjQ1LDIxNC43NjgsMTQ4LjYyOSwyODguNTE0LDE0OC42MjkgTTI4OC41MTQsMTEzLjY1N0MxMjkuMTc2LDExMy42NTcsMCwyNTMuNTQzLDAsMjg4LjUxNSAgIHMxMjkuMTc2LDE3NC44NTcsMjg4LjUxNCwxNzQuODU3YzE1OS4zMzksMCwyODguNTE1LTEzOS44ODYsMjg4LjUxNS0xNzQuODU3UzQ0Ny44NTQsMTEzLjY1NywyODguNTE0LDExMy42NTdMMjg4LjUxNCwxMTMuNjU3eiAgICBNMjg4LjUxNCwxODMuNjAxYy01Ny45MzksMC0xMDQuOTE0LDQ2Ljk3NS0xMDQuOTE0LDEwNC45MTRjMCw1Ny45MzgsNDYuOTc1LDEwNC45MTQsMTA0LjkxNCwxMDQuOTE0ICAgczEwNC45MTQtNDYuOTc2LDEwNC45MTQtMTA0LjkxNEMzOTMuNDI4LDIzMC41NzYsMzQ2LjQ1MywxODMuNjAxLDI4OC41MTQsMTgzLjYwMXogTTI2MC4yNjYsMjg4LjUxNSAgIGMtMjQuNTE1LDAtNDQuMzg4LTE5Ljg3My00NC4zODgtNDQuMzg4YzAtMjQuNTE1LDE5Ljg3My00NC4zODcsNDQuMzg4LTQ0LjM4N2MyNC41MTUsMCw0NC4zODgsMTkuODczLDQ0LjM4OCw0NC4zODcgICBDMzA0LjY1NCwyNjguNjQyLDI4NC43ODEsMjg4LjUxNSwyNjAuMjY2LDI4OC41MTV6IiBmaWxsPSIjMDA2REYwIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==" /></a>

					</li>

				{% endfor %}

			</ul>

		</div>

		<div class='grid-item footer'>
			<p>{{ site_title }} Administration | <a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet" target="_blank">Markdown Cheatsheet</a></p>
		</div>
	</div>

	<!-- Save snackbar -->
	<div id="saving">Saving...</div>

	<script src="{{ base_url }}/plugins/pico_edit/libs/jquery-1.12.3.min.js"></script>

	<script src="{{ base_url }}/plugins/pico_edit/libs/epiceditor/js/epiceditor.min.js"></script>

	<script>
		
		$(document).ready(function() {

			// Logout is REQUIRED
			window.onbeforeunload = function() {

				return "Did you log out?"

			}

			// Prevent close warning for logout button
			document.getElementById('logout').onclick = function() {

				window.onbeforeunload = null;

			};

			// Switch editor to preview mode
			$("#preview-btn").click(function() {

				editor.preview();

			});

			// Switch editor to edit mode
			$("#edit-btn").click(function() {

				editor.edit();

			});

			var unsaved = false;

			var editor = new EpicEditor({

				container: 'epiceditor',

				basePath: '{{ base_url }}/plugins/pico_edit/libs/epiceditor',

				clientSideStorage: false,

				useNativeFullscreen: false,

				file: {

					name: 'epiceditor',

					defaultContent: '',

					autoSave: 5000

				},

				theme: {

					base: '{{ base_url }}/plugins/pico_edit/libs/epiceditor/themes/base/epiceditor.css',

					preview: '{{ base_url }}/plugins/pico_edit/libs/epiceditor/themes/preview/github.css',

					editor: '{{ base_url }}/plugins/pico_edit/libs/epiceditor/themes/editor/epic-dark.css'

				},

				button: {

					preview: false,

					fullscreen: false,

					bar: false

				},

				focusOnLoad: true

			}).load();

			$.post('{{ pico_edit_url }}/open', {

				file: "index"

			}, function(data) {

				$('#epiceditor').data('currentFile', "index");

				editor.importFile('epiceditor', data);

				unsaved = false;

				document.title = document.title.replace(' *', '');

			});

			$(editor.getElement('editor')).on('keyup', function() {

				if (!unsaved) {

					unsaved = true;

					document.title += ' *';

				}

			});

			// New
			$('.controls .new').on('click', function(e) {

				e.preventDefault();

				var title = prompt('Enter page title; optionally with path, example: sub folder/my page', '');

				if (title != null && title != '') {

					$.post('{{ pico_edit_url }}/new', {

						title: title

					}, function(data) {

						if (data.error) {

							alert(data.error);

						} else {

							$('.nav .post').removeClass('open');

							$('#epiceditor').data('currentFile', data.file);

							editor.importFile('epiceditor', data.content);

							unsaved = false;

							document.title = document.title.replace(' *', '');

							$('.nav').append('<li><a href="#" data-url="' + data.file + '" class="post list-group-item">/' + data.file + '</a></li><li><a href="' + data.url + '" target="_blank" class="view" title="View"><i class="fa fa-eye" aria-hidden="true"></i></a></li><li><a href="#" data-url="' + data.file + '" class="delete" title="Delete"><i class="fa fa-trash-o" aria-hidden="true"></i></a></li>')

						}

					}, 'json');

				}

			});

			// Open post
			$('.nav').on('click', '.post', function(e) {

				e.preventDefault();

				if (unsaved && !confirm('You have unsaved changes. Are you sure you want to leave this post?')) return false;

				$('.nav .post, .post').removeClass('open');

				$(this).addClass('open');

				var fileUrl = $(this).attr('data-url');

				$.post('{{ pico_edit_url }}/open', {

					file: fileUrl

				}, function(data) {

					$('#epiceditor').data('currentFile', fileUrl);

					editor.importFile('epiceditor', data);

					unsaved = false;

					document.title = document.title.replace(' *', '');

				});

			});

			// Save post
			editor.on('autosave', function() {

				$('#saving').text('Saving...').addClass('visible');

				$.post('{{ pico_edit_url }}/save', {

					file: $('#epiceditor').data('currentFile'),

					content: editor.exportFile()

				}, function(data) {

					$('#saving').text('Saved');

					unsaved = false;

					document.title = document.title.replace(' *', '');

					setTimeout(function() {

						$('#saving').removeClass('visible');

					}, 1000);

				});

			});

			// Save on preview
			editor.on('preview', function() {

				editor.emit('autosave');

			});

			// btn - Delete
			$('.nav').on('click', '.delete', function(e) {

				e.preventDefault();

				if (!confirm('Are you sure you want to delete this file?')) return false;

				$('.nav .post').removeClass('open');

				var tr = $(this).parents('tr');

				var fileUrl = $(this).attr('data-url');

				$.post('{{ pico_edit_url }}/delete', {

					file: fileUrl

				}, function(data) {

					tr.remove();

					$('#epiceditor').data('currentFile', '');

					editor.importFile('epiceditor', '');

					unsaved = false;

					document.title = document.title.replace(' *', '');

				});

			});

			// btn - Save
			$('.controls').on('click', '.savebutton', function(e) {

				e.preventDefault();

				$('#saving').text('Saving...').addClass('visible');

				$.post('{{ pico_edit_url }}/save', {

					file: $('#epiceditor').data('currentFile'),

					content: editor.exportFile()

				}, function(data) {

					$('#saving').text('Saved');

					unsaved = false;

					document.title = document.title.replace(' *', '');

					setTimeout(function() {

						$('#saving').removeClass('visible');

					}, 1000);

				});

			});

			// btn - Clear cache
			$('.controls').on('click', '.clearcachebutton', function(e) {

				e.preventDefault();

				$('#saving').text('Clearing...').addClass('visible');

				$.post('{{ pico_edit_url }}/clearcache', {}, function(data) {

					$('#saving').text('Cache cleared');

					setTimeout(function() {

						$('#saving').removeClass('visible');

					}, 1000);

				});

			});


		});

	</script>

</body>

</html>